<!doctype html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Ù…Ù„Ø§Ø°Ùƒ Ø§Ù„Ø¢Ù…Ù† | Safe Haven</title>
  <meta name="description" content="Ù…Ù„Ø§Ø°Ùƒ Ø§Ù„Ø¢Ù…Ù† | Safe Haven â€” Ù…Ø³Ø§Ø­Ø© Ø±Ù‚Ù…ÙŠØ© Ù„Ù„Ø§Ø·Ù…Ø¦Ù†Ø§Ù†ØŒ Ù…Ø­Ø§Ø¯Ø«Ø© Ø¯Ø§Ø¹Ù…Ø©ØŒ Ù…ÙˆØ§Ø±Ø¯ Ø¹Ù…Ù„ÙŠØ©ØŒ ÙˆØ®Ø·ÙˆØ§Øª Ø¨Ø³ÙŠØ·Ø© Ù„Ø¯Ø¹Ù… Ø§Ù„ØµØ­Ø© Ø§Ù„Ù†ÙØ³ÙŠØ©." />
  <script src="https://cdn.jsdelivr.net/npm/@tailwindcss/browser@4"></script>
  <style>
    :root { color-scheme: light; }
    .glass { backdrop-filter: blur(10px); -webkit-backdrop-filter: blur(10px); }
    .ring-soft { box-shadow: 0 0 0 6px rgba(99,102,241,.12); }
    .fade-in { animation: fadeIn .6s ease-out both; }
    @keyframes fadeIn { from { opacity: 0; transform: translateY(8px);} to { opacity: 1; transform: translateY(0);} }
    /* Calm night background with gradient */
    .night-bg {
      background: linear-gradient(180deg, #0a0a1a 0%, #1a1a2e 40%, #16213e 70%, #0f0f23 100%);
      background-attachment: fixed;
    }
    /* Stars layer */
    .starfield::before {
      content: "";
      position: absolute;
      inset: 0;
      background-image:
        radial-gradient(2px 2px at 10% 15%, rgba(255,255,255,.5) 50%, transparent 52%),
        radial-gradient(1px 1px at 25% 8%, rgba(255,255,255,.4) 50%, transparent 52%),
        radial-gradient(1.5px 1.5px at 40% 25%, rgba(255,255,255,.35) 50%, transparent 52%),
        radial-gradient(1px 1px at 55% 12%, rgba(255,255,255,.3) 50%, transparent 52%),
        radial-gradient(2px 2px at 70% 20%, rgba(255,255,255,.45) 50%, transparent 52%),
        radial-gradient(1px 1px at 85% 30%, rgba(255,255,255,.25) 50%, transparent 52%),
        radial-gradient(1.5px 1.5px at 15% 45%, rgba(255,255,255,.3) 50%, transparent 52%),
        radial-gradient(1px 1px at 90% 50%, rgba(255,255,255,.35) 50%, transparent 52%),
        radial-gradient(2px 2px at 5% 70%, rgba(255,255,255,.4) 50%, transparent 52%),
        radial-gradient(1px 1px at 60% 65%, rgba(255,255,255,.25) 50%, transparent 52%);
      opacity: 1;
      pointer-events: none;
      animation: twinkle 4s ease-in-out infinite alternate;
    }
    @keyframes twinkle {
      0% { opacity: 0.6; }
      100% { opacity: 1; }
    }
    /* Rain animation */
    .rain-container {
      position: fixed;
      inset: 0;
      pointer-events: none;
      overflow: hidden;
      z-index: 1;
    }
    .rain-drop {
      position: absolute;
      width: 2px;
      background: linear-gradient(to bottom, transparent, rgba(174, 194, 224, 0.4), rgba(174, 194, 224, 0.7));
      animation: rain-fall linear infinite;
      border-radius: 0 0 5px 5px;
    }
    @keyframes rain-fall {
      0% {
        transform: translateY(-100vh) translateX(0);
        opacity: 0;
      }
      10% {
        opacity: 1;
      }
      90% {
        opacity: 1;
      }
      100% {
        transform: translateY(100vh) translateX(-30px);
        opacity: 0;
      }
    }
    /* Soft glow overlay */
    .glow-overlay {
      position: absolute;
      inset: 0;
      background:
        radial-gradient(ellipse at 20% 20%, rgba(99,102,241,.08), transparent 50%),
        radial-gradient(ellipse at 80% 30%, rgba(16,185,129,.06), transparent 45%),
        radial-gradient(ellipse at 50% 80%, rgba(139,92,246,.05), transparent 50%);
      pointer-events: none;
    }
    /* Typing indicator */
    .typing-dots {
      display: inline-flex;
      gap: 4px;
      padding: 8px 0;
    }
    .typing-dots span {
      width: 8px;
      height: 8px;
      background: #6366f1;
      border-radius: 50%;
      animation: typing-bounce 1.4s ease-in-out infinite;
    }
    .typing-dots span:nth-child(2) { animation-delay: 0.2s; }
    .typing-dots span:nth-child(3) { animation-delay: 0.4s; }
    @keyframes typing-bounce {
      0%, 60%, 100% { transform: translateY(0); }
      30% { transform: translateY(-10px); }
    }
    /* Custom scrollbar */
    #chatLog::-webkit-scrollbar {
      width: 6px;
    }
    #chatLog::-webkit-scrollbar-track {
      background: #f1f5f9;
      border-radius: 10px;
    }
    #chatLog::-webkit-scrollbar-thumb {
      background: #cbd5e1;
      border-radius: 10px;
    }
  </style>
</head>
<body class="min-h-screen bg-slate-50 text-slate-900 selection:bg-indigo-200 selection:text-slate-900">
  <!-- Top background (calm night + stars) -->
  <div class="fixed inset-0 -z-10 night-bg">
    <div class="pointer-events-none absolute inset-0 starfield"></div>
    <div class="pointer-events-none absolute inset-0 glow-overlay"></div>
  </div>
  <!-- Rain animation container -->
  <div id="rainContainer" class="rain-container"></div>
  <!-- Header -->
  <header class="sticky top-0 z-40">
    <div class="mx-auto max-w-6xl px-4 py-3">
      <div class="glass rounded-2xl border border-white/40 bg-white/70 shadow-sm">
        <div class="flex items-center justify-between gap-3 px-4 py-3">
          <a href="#home" class="flex items-center gap-3">
            <div class="grid h-10 w-10 place-items-center rounded-2xl bg-indigo-600 text-white shadow-sm">
              <span class="text-lg font-bold">Ù…</span>
            </div>
            <div class="leading-tight">
              <div class="text-base font-extrabold tracking-tight">Ù…Ù„Ø§Ø°Ùƒ Ø§Ù„Ø¢Ù…Ù†</div>
              <div class="text-xs text-slate-600">Ù„Ø±Ø§Ø­Ø© Ø§Ù„Ù‚Ù„Ø¨ ÙˆØ·Ù…Ø£Ù†ÙŠÙ†Ø© Ø§Ù„Ù†ÙØ³</div>
            </div>
          </a>
          <nav class="hidden items-center gap-2 md:flex">
            <a class="rounded-xl px-3 py-2 text-sm font-semibold text-slate-700 hover:bg-slate-900/5" href="#services">Ø§Ù„Ø®Ø¯Ù…Ø§Øª</a>
            <a class="rounded-xl px-3 py-2 text-sm font-semibold text-slate-700 hover:bg-slate-900/5" href="#tools">Ø£Ø¯ÙˆØ§Øª Ø³Ø±ÙŠØ¹Ø©</a>
            <a class="rounded-xl px-3 py-2 text-sm font-semibold text-slate-700 hover:bg-slate-900/5" href="#chat">Ù…Ø­Ø§Ø¯Ø«Ø© AI</a>
            <a class="rounded-xl px-3 py-2 text-sm font-semibold text-slate-700 hover:bg-slate-900/5" href="#resources">Ø§Ù„Ù…ÙˆØ§Ø±Ø¯</a>
            <a class="rounded-xl px-3 py-2 text-sm font-semibold text-slate-700 hover:bg-slate-900/5" href="#contact">ØªÙˆØ§ØµÙ„</a>
          </nav>
          <div class="flex items-center gap-2">
            <button id="openMenu" class="md:hidden rounded-xl border border-slate-200 bg-white px-3 py-2 text-sm font-semibold hover:bg-slate-50" aria-label="ÙØªØ­ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø©">Ø§Ù„Ù‚Ø§Ø¦Ù…Ø©</button>
            <button id="muteToggle" class="rounded-xl border border-slate-200 bg-white px-3 py-2 text-sm font-semibold hover:bg-slate-50" aria-label="ÙƒØªÙ… Ø§Ù„ØµÙˆØª">
              <span id="muteLabel">ğŸ”Š</span>
            </button>
          </div>
        </div>
      </div>
      <!-- Mobile menu -->
      <div id="mobileMenu" class="mt-2 hidden fade-in">
        <div class="glass rounded-2xl border border-white/40 bg-white/70 shadow-sm">
          <nav class="grid gap-1 p-2">
            <a class="rounded-xl px-3 py-2 text-sm font-semibold text-slate-700 hover:bg-slate-900/5" href="#services">Ø§Ù„Ø®Ø¯Ù…Ø§Øª</a>
            <a class="rounded-xl px-3 py-2 text-sm font-semibold text-slate-700 hover:bg-slate-900/5" href="#tools">Ø£Ø¯ÙˆØ§Øª Ø³Ø±ÙŠØ¹Ø©</a>
            <a class="rounded-xl px-3 py-2 text-sm font-semibold text-slate-700 hover:bg-slate-900/5" href="#chat">Ù…Ø­Ø§Ø¯Ø«Ø© AI</a>
            <a class="rounded-xl px-3 py-2 text-sm font-semibold text-slate-700 hover:bg-slate-900/5" href="#resources">Ø§Ù„Ù…ÙˆØ§Ø±Ø¯</a>
            <a class="rounded-xl px-3 py-2 text-sm font-semibold text-slate-700 hover:bg-slate-900/5" href="#contact">ØªÙˆØ§ØµÙ„</a>
          </nav>
        </div>
      </div>
    </div>
  </header>
  <!-- Main -->
  <main id="home" class="mx-auto max-w-6xl px-4 relative z-10">
    <!-- Hero -->
    <section class="pt-10 md:pt-14">
      <div class="grid gap-6 md:grid-cols-2 md:items-center">
        <div class="fade-in">
          <div class="inline-flex items-center gap-2 rounded-full border border-white/40 bg-white/70 px-3 py-1.5 text-xs font-semibold text-slate-700 shadow-sm">
            <span class="inline-block h-2 w-2 rounded-full bg-emerald-500 animate-pulse"></span>
            Ù…Ø³Ø§Ø­Ø© Ù„Ø·ÙŠÙØ© ÙˆØ¢Ù…Ù†Ø© â€” Ø®Ø·ÙˆØ© Ø¨Ø®Ø·ÙˆØ©
          </div>
          <h1 class="mt-4 text-3xl font-extrabold tracking-tight text-slate-900 md:text-5xl">
            Ù…Ù„Ø§Ø°Ùƒ Ø§Ù„Ø¢Ù…Ù†
            <span class="block text-indigo-700">Ù‡Ù†Ø§â€¦ ØªÙ†ÙÙ‘Ø³ØŒ ÙˆØ§Ù‡Ø¯Ø£ØŒ ÙˆØ§Ø¨Ø¯Ø£ Ù…Ù† Ø¬Ø¯ÙŠØ¯</span>
          </h1>
          <p class="mt-4 max-w-prose text-base leading-7 text-slate-700 md:text-lg">
            Ù…ÙˆÙ‚Ø¹ Ø¨Ø³ÙŠØ· ÙŠØ³Ø§Ø¹Ø¯Ùƒ Ø¹Ù„Ù‰ ØªÙ†Ø¸ÙŠÙ… Ø£ÙÙƒØ§Ø±ÙƒØŒ ØªÙ‡Ø¯Ø¦Ø© ØªÙˆØªØ±ÙƒØŒ ÙˆØ§Ù„ÙˆØµÙˆÙ„ Ø¥Ù„Ù‰ Ù…ÙˆØ§Ø±Ø¯ Ø¯Ø§Ø¹Ù…Ø© Ù…Ø¹ Ù…Ø­Ø§Ø¯Ø«Ø© Ø°ÙƒÙŠØ© ØªÙÙ‡Ù… Ù…Ø´Ø§Ø¹Ø±Ùƒ ÙˆØªØ¯Ø¹Ù…Ùƒ Ø¨Ù„Ø·Ù.
          </p>
          <div class="mt-6 flex flex-wrap gap-3">
            <a href="#chat" class="rounded-2xl bg-indigo-600 px-5 py-3 text-sm font-bold text-white shadow-sm hover:bg-indigo-700 focus:outline-none focus:ring-4 focus:ring-indigo-200">Ø§Ø¨Ø¯Ø£ Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø© Ù…Ø¹ AI</a>
            <a href="#tools" class="rounded-2xl border border-slate-200 bg-white px-5 py-3 text-sm font-bold text-slate-800 shadow-sm hover:bg-slate-50 focus:outline-none focus:ring-4 focus:ring-indigo-100">Ø£Ø¯ÙˆØ§Øª Ø³Ø±ÙŠØ¹Ø©</a>
          </div>
          <div class="mt-6 grid grid-cols-3 gap-3">
            <div class="rounded-2xl border border-white/40 bg-white/70 p-4 shadow-sm">
              <div class="text-sm font-extrabold text-slate-900" id="statBreaths">3</div>
              <div class="text-xs text-slate-600">ØªÙ…Ø§Ø±ÙŠÙ† ØªÙ†ÙÙ‘Ø³</div>
            </div>
            <div class="rounded-2xl border border-white/40 bg-white/70 p-4 shadow-sm">
              <div class="text-sm font-extrabold text-slate-900" id="statNotes">0</div>
              <div class="text-xs text-slate-600">Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ù…Ø­ÙÙˆØ¸Ø©</div>
            </div>
            <div class="rounded-2xl border border-white/40 bg-white/70 p-4 shadow-sm">
              <div class="text-sm font-extrabold text-slate-900" id="statMood">â€”</div>
              <div class="text-xs text-slate-600">Ø¢Ø®Ø± Ù…Ø²Ø§Ø¬</div>
            </div>
          </div>
        </div>
        <div class="fade-in md:justify-self-end">
          <div class="relative overflow-hidden rounded-3xl border border-white/40 bg-white/70 p-6 shadow-sm">
            <div class="absolute -top-12 -left-12 h-48 w-48 rounded-full bg-indigo-500/15 blur-2xl"></div>
            <div class="absolute -bottom-16 -right-16 h-56 w-56 rounded-full bg-emerald-500/10 blur-2xl"></div>
            <h2 class="text-lg font-extrabold">Ù„ÙˆØ­Ø© Ø§Ù„Ø·Ù…Ø£Ù†ÙŠÙ†Ø©</h2>
            <p class="mt-1 text-sm text-slate-700">Ø§Ø®ØªØ± Ù…Ø²Ø§Ø¬Ùƒ Ø§Ù„Ø¢Ù† ÙˆØ§Ø­ØµÙ„ Ø¹Ù„Ù‰ Ø§Ù‚ØªØ±Ø§Ø­ Ù„Ø·ÙŠÙ.</p>
            <div class="mt-4 grid grid-cols-2 gap-3">
              <button data-mood="Ù…ØªÙˆØªØ±" class="moodBtn rounded-2xl border border-slate-200 bg-white px-4 py-3 text-sm font-bold text-slate-800 hover:bg-slate-50 transition-all">ğŸ˜° Ù…ØªÙˆØªØ±</button>
              <button data-mood="Ø­Ø²ÙŠÙ†" class="moodBtn rounded-2xl border border-slate-200 bg-white px-4 py-3 text-sm font-bold text-slate-800 hover:bg-slate-50 transition-all">ğŸ˜¢ Ø­Ø²ÙŠÙ†</button>
              <button data-mood="Ù…Ø´ØªÙ‘Øª" class="moodBtn rounded-2xl border border-slate-200 bg-white px-4 py-3 text-sm font-bold text-slate-800 hover:bg-slate-50 transition-all">ğŸ¤¯ Ù…Ø´ØªÙ‘Øª</button>
              <button data-mood="Ù…Ù…ØªÙ†" class="moodBtn rounded-2xl border border-slate-200 bg-white px-4 py-3 text-sm font-bold text-slate-800 hover:bg-slate-50 transition-all">ğŸ™ Ù…Ù…ØªÙ†</button>
            </div>
            <div class="mt-4 rounded-2xl border border-slate-200 bg-white p-4">
              <div class="text-xs font-semibold text-slate-500">Ø§Ù‚ØªØ±Ø§Ø­ Ø§Ù„ÙŠÙˆÙ…</div>
              <div id="moodSuggestion" class="mt-1 text-sm font-bold text-slate-900">Ø§Ø®ØªØ± Ù…Ø²Ø§Ø¬Ùƒ Ù„Ø¹Ø±Ø¶ Ø§Ù‚ØªØ±Ø§Ø­ Ù…Ù†Ø§Ø³Ø¨.</div>
            </div>
            <div class="mt-4 flex items-center justify-between gap-3">
              <div class="text-xs text-slate-600">ÙŠØªÙ… Ø­ÙØ¸ Ø¢Ø®Ø± Ø§Ø®ØªÙŠØ§Ø± Ø¹Ù„Ù‰ Ø¬Ù‡Ø§Ø²Ùƒ.</div>
              <button id="clearMood" class="rounded-xl border border-slate-200 bg-white px-3 py-2 text-xs font-bold text-slate-800 hover:bg-slate-50">Ù…Ø³Ø­</button>
            </div>
          </div>
        </div>
      </div>
    </section>
    <!-- Services -->
    <section id="services" class="pt-14 md:pt-18">
      <div class="flex items-end justify-between gap-4">
        <div>
          <h2 class="text-2xl font-extrabold tracking-tight">Ø§Ù„Ø®Ø¯Ù…Ø§Øª</h2>
          <p class="mt-1 text-sm text-slate-700">Ø£Ø¯ÙˆØ§Øª ØµØºÙŠØ±Ø© ØªØ³Ø§Ø¹Ø¯Ùƒ Ø¹Ù„Ù‰ Ø¨Ù†Ø§Ø¡ Ø¹Ø§Ø¯Ø© Ù‡Ø§Ø¯Ø¦Ø©.</p>
        </div>
      </div>
      <div class="mt-6 grid gap-4 md:grid-cols-3">
        <div class="rounded-3xl border border-white/40 bg-white/70 p-6 shadow-sm">
          <div class="text-2xl mb-2">ğŸ§˜</div>
          <div class="text-sm font-extrabold">ØªÙ†ÙÙ‘Ø³ Ù…ÙˆØ¬Ù‘Ù‡</div>
          <p class="mt-1 text-sm text-slate-700">Ù…Ø¤Ù‚Ù‘Øª Ø¨Ø³ÙŠØ· ÙŠØ³Ø§Ø¹Ø¯Ùƒ Ø¹Ù„Ù‰ ØªÙ‡Ø¯Ø¦Ø© Ø§Ù„Ø¬Ø³Ø¯ Ø®Ù„Ø§Ù„ Ø¯Ù‚Ø§Ø¦Ù‚.</p>
          <a href="#tools" class="mt-4 inline-flex items-center gap-2 text-sm font-bold text-indigo-700 hover:text-indigo-800">Ø¬Ø±Ù‘Ø¨Ù‡ Ø§Ù„Ø¢Ù† â†</a>
        </div>
        <div class="rounded-3xl border border-white/40 bg-white/70 p-6 shadow-sm">
          <div class="text-2xl mb-2">ğŸ¤–</div>
          <div class="text-sm font-extrabold">Ù…Ø­Ø§Ø¯Ø«Ø© AI Ø°ÙƒÙŠØ©</div>
          <p class="mt-1 text-sm text-slate-700">ØªØ­Ø¯Ø« Ù…Ø¹ Ø°ÙƒØ§Ø¡ Ø§ØµØ·Ù†Ø§Ø¹ÙŠ ÙŠÙÙ‡Ù… Ù…Ø´Ø§Ø¹Ø±Ùƒ ÙˆÙŠØ±Ø¯ Ø¨Ù„Ø·Ù ÙˆØ¯Ø¹Ù….</p>
          <a href="#chat" class="mt-4 inline-flex items-center gap-2 text-sm font-bold text-indigo-700 hover:text-indigo-800">Ø§Ø¨Ø¯Ø£ Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø© â†</a>
        </div>
        <div class="rounded-3xl border border-white/40 bg-white/70 p-6 shadow-sm">
          <div class="text-2xl mb-2">ğŸ“š</div>
          <div class="text-sm font-extrabold">Ù…ÙˆØ§Ø±Ø¯ Ø¯Ø§Ø¹Ù…Ø©</div>
          <p class="mt-1 text-sm text-slate-700">Ù‚Ø§Ø¦Ù…Ø© ØªØ°ÙƒÙŠØ±ÙŠØ© Ø¨Ø®Ø·ÙˆØ§Øª Ù…ÙÙŠØ¯Ø© Ø¹Ù†Ø¯ Ø§Ù„Ø¶ØºØ·.</p>
          <a href="#resources" class="mt-4 inline-flex items-center gap-2 text-sm font-bold text-indigo-700 hover:text-indigo-800">Ø§Ø³ØªØ¹Ø±Ø¶ â†</a>
        </div>
      </div>
    </section>
    <!-- Chat with AI -->
    <section id="chat" class="pt-14 md:pt-18">
      <div class="grid gap-4 md:grid-cols-5">
        <div class="md:col-span-3 rounded-3xl border border-white/40 bg-white/70 p-6 shadow-sm">
          <div class="flex flex-col gap-2 md:flex-row md:items-end md:justify-between">
            <div>
              <h2 class="text-2xl font-extrabold tracking-tight">Ù…Ø­Ø§Ø¯Ø«Ø© Ø°ÙƒÙŠØ© Ø¯Ø§Ø¹Ù…Ø© | AI Support Chat</h2>
              <p class="mt-1 text-sm text-slate-700">Ù…Ø­Ø§Ø¯Ø«Ø© Ù…Ø¹ Ø°ÙƒØ§Ø¡ Ø§ØµØ·Ù†Ø§Ø¹ÙŠ ÙŠÙÙ‡Ù… Ù…Ø´Ø§Ø¹Ø±Ùƒ ÙˆÙŠØ±Ø¯ Ø¨Ù„Ø·Ù ÙˆØªØ¹Ø§Ø·Ù (Ù…Ø­Ø§ÙŠØ¯ Ø¬Ù†Ø¯Ø±ÙŠÙ‹Ø§).</p>
            </div>
            <div class="flex flex-wrap items-center gap-2">
              <select id="chatLang" class="rounded-2xl border border-slate-200 bg-white px-3 py-2 text-sm font-bold">
                <option value="ar">Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©</option>
                <option value="en">English</option>
              </select>
              <button id="clearChat" class="rounded-2xl border border-slate-200 bg-white px-3 py-2 text-sm font-bold hover:bg-slate-50">Ù…Ø³Ø­ | Clear</button>
            </div>
          </div>
          <div id="chatLog" class="mt-4 h-[420px] overflow-auto rounded-3xl border border-slate-200 bg-white p-4">
            <div class="text-sm text-slate-500 text-center py-8">
              <div class="text-4xl mb-3">ğŸ’¬</div>
              Ø§Ø¨Ø¯Ø£ Ø¨ÙƒØªØ§Ø¨Ø© Ø±Ø³Ø§Ù„Ø© Ù„Ù„ØªØ­Ø¯Ø« Ù…Ø¹ Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠâ€¦<br>
              Start typing to chat with AIâ€¦
            </div>
          </div>
          <form id="chatForm" class="mt-4 grid gap-3">
            <div class="grid gap-2 md:grid-cols-6">
              <textarea id="chatInput" rows="2" class="md:col-span-5 w-full rounded-2xl border border-slate-200 bg-white p-3 text-sm leading-6 outline-none focus:ring-4 focus:ring-indigo-100" placeholder="Ø§ÙƒØªØ¨ Ù‡Ù†Ø§â€¦ | Type hereâ€¦"></textarea>
              <button class="md:col-span-1 rounded-2xl bg-indigo-600 px-4 py-2.5 text-sm font-bold text-white hover:bg-indigo-700 focus:outline-none focus:ring-4 focus:ring-indigo-200" type="submit">Ø¥Ø±Ø³Ø§Ù„</button>
            </div>
            <div class="rounded-2xl border border-amber-200 bg-amber-50 p-3 text-xs text-amber-900">
              <span class="font-semibold">âš ï¸ Ù…Ù„Ø§Ø­Ø¸Ø©:</span> Ù‡Ø°Ù‡ Ù…Ø­Ø§Ø¯Ø«Ø© Ø¯Ø§Ø¹Ù…Ø© ÙˆÙ„ÙŠØ³Øª Ø¨Ø¯ÙŠÙ„Ø§Ù‹ Ø¹Ù† Ù…Ø®ØªØµ. ÙÙŠ Ø­Ø§Ù„Ø© Ø®Ø·Ø± ÙÙˆØ±ÙŠØŒ ØªÙˆØ§ØµÙ„ Ù…Ø¹ Ø§Ù„Ø·ÙˆØ§Ø±Ø¦.
            </div>
          </form>
        </div>
        <div class="md:col-span-2 grid gap-4">
          <!-- API Key Configuration -->
          <div class="rounded-3xl border border-white/40 bg-white/70 p-6 shadow-sm">
            <h3 class="text-lg font-extrabold">âš™ï¸ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª AI | AI Settings</h3>
            <p class="mt-1 text-sm text-slate-700">Ø£Ø¯Ø®Ù„ Ù…ÙØªØ§Ø­ OpenAI API Ù„ØªÙØ¹ÙŠÙ„ Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø© Ø§Ù„Ø°ÙƒÙŠØ©.</p>
            <div class="mt-4 grid gap-3">
              <label class="grid gap-1 text-xs font-semibold text-slate-700">
                OpenAI API Key
                <input id="apiKeyInput" type="password" class="w-full rounded-2xl border border-slate-200 bg-white px-3 py-2.5 text-sm outline-none focus:ring-4 focus:ring-indigo-100" placeholder="sk-..." />
              </label>
              <div class="flex items-center gap-2">
                <button id="saveApiKey" type="button" class="rounded-2xl bg-indigo-600 px-4 py-2.5 text-sm font-bold text-white hover:bg-indigo-700">Ø­ÙØ¸</button>
                <button id="clearApiKey" type="button" class="rounded-2xl border border-slate-200 bg-white px-4 py-2.5 text-sm font-bold text-slate-800 hover:bg-slate-50">Ù…Ø³Ø­</button>
              </div>
              <div id="apiStatus" class="rounded-2xl border border-slate-200 bg-white p-3 text-xs"></div>
              <div class="rounded-2xl border border-emerald-200 bg-emerald-50 p-3 text-xs text-emerald-900">
                <span class="font-semibold">ğŸ”’ Ø¢Ù…Ù†:</span> Ø§Ù„Ù…ÙØªØ§Ø­ ÙŠÙØ­ÙØ¸ Ù…Ø­Ù„ÙŠÙ‹Ø§ ÙÙŠ Ù…ØªØµÙØ­Ùƒ ÙÙ‚Ø· ÙˆÙ„Ø§ ÙŠÙØ±Ø³Ù„ Ù„Ø£ÙŠ Ø¬Ù‡Ø© Ø®Ø§Ø±Ø¬ÙŠØ©.
              </div>
            </div>
          </div>
          <div class="rounded-3xl border border-white/40 bg-white/70 p-6 shadow-sm">
            <h3 class="text-lg font-extrabold">ğŸ’¡ Ø§Ù‚ØªØ±Ø§Ø­Ø§Øª Ø³Ø±ÙŠØ¹Ø© | Quick prompts</h3>
            <div class="mt-3 grid gap-2">
              <button data-q="Ø£Ø´Ø¹Ø± Ø¨Ø¶ØºØ· ÙˆØªÙˆØªØ± Ø´Ø¯ÙŠØ¯ ÙˆÙ„Ø§ Ø£Ø¹Ø±Ù ÙƒÙŠÙ Ø£Ù‡Ø¯Ø£" class="quickPrompt rounded-2xl border border-slate-200 bg-white px-3 py-2 text-sm font-bold hover:bg-slate-50 text-right">ğŸ˜° Ø¶ØºØ· ÙˆØªÙˆØªØ±</button>
              <button data-q="Ù„Ø¯ÙŠ Ø£ÙÙƒØ§Ø± ÙƒØ«ÙŠØ±Ø© ÙˆÙ„Ø§ Ø£Ø³ØªØ·ÙŠØ¹ Ø§Ù„ØªØ±ÙƒÙŠØ² Ø£Ø¨Ø¯Ø§Ù‹" class="quickPrompt rounded-2xl border border-slate-200 bg-white px-3 py-2 text-sm font-bold hover:bg-slate-50 text-right">ğŸ¤¯ Ø£ÙÙƒØ§Ø± ÙƒØ«ÙŠØ±Ø©</button>
              <button data-q="Ø£Ø´Ø¹Ø± Ø¨Ø§Ù„Ø­Ø²Ù† ÙˆØ§Ù„ÙˆØ­Ø¯Ø© ÙˆÙ„Ø§ Ø£Ø­Ø¯ ÙŠÙÙ‡Ù…Ù†ÙŠ" class="quickPrompt rounded-2xl border border-slate-200 bg-white px-3 py-2 text-sm font-bold hover:bg-slate-50 text-right">ğŸ˜¢ Ø­Ø²Ù† ÙˆÙˆØ­Ø¯Ø©</button>
              <button data-q="I can't sleep and feel anxious at night" class="quickPrompt rounded-2xl border border-slate-200 bg-white px-3 py-2 text-sm font-bold hover:bg-slate-50 text-left">ğŸ˜´ Sleep issues</button>
              <button data-q="I feel overwhelmed and need emotional support" class="quickPrompt rounded-2xl border border-slate-200 bg-white px-3 py-2 text-sm font-bold hover:bg-slate-50 text-left">ğŸ’” Overwhelmed</button>
            </div>
          </div>
          <div class="rounded-3xl border border-white/40 bg-white/70 p-6 shadow-sm">
            <h3 class="text-lg font-extrabold">ğŸ”Š Ù†Ø·Ù‚ Ø§Ù„Ø±Ø¯ÙˆØ¯ | Voice</h3>
            <div class="mt-3 flex flex-wrap gap-2">
              <button id="speakLast" type="button" class="rounded-2xl border border-slate-200 bg-white px-3 py-2 text-sm font-bold hover:bg-slate-50">ğŸ”ˆ Ù†Ø·Ù‚ Ø¢Ø®Ø± Ø±Ø¯</button>
              <button id="stopSpeak" type="button" class="rounded-2xl border border-slate-200 bg-white px-3 py-2 text-sm font-bold hover:bg-slate-50">â¹ï¸ Ø¥ÙŠÙ‚Ø§Ù</button>
            </div>
          </div>
        </div>
      </div>
    </section>
    <!-- Tools -->
    <section id="tools" class="pt-14 md:pt-18">
      <h2 class="text-2xl font-extrabold tracking-tight">Ø£Ø¯ÙˆØ§Øª Ø³Ø±ÙŠØ¹Ø©</h2>
      <p class="mt-1 text-sm text-slate-700">Ø¨Ø¯ÙˆÙ† Ø­Ø³Ø§Ø¨Ø§Øª â€” ÙƒÙ„ Ø´ÙŠØ¡ ÙŠÙØ­ÙØ¸ Ù…Ø­Ù„ÙŠÙ‹Ø§ Ø¹Ù„Ù‰ Ø¬Ù‡Ø§Ø²Ùƒ.</p>
      <div class="mt-6 grid gap-4 md:grid-cols-2">
        <!-- Breathing -->
        <div class="rounded-3xl border border-white/40 bg-white/70 p-6 shadow-sm">
          <div class="flex items-start justify-between gap-4">
            <div>
              <div class="text-sm font-extrabold">ğŸ§˜ Ù…Ø¤Ù‚Ù‘Øª Ø§Ù„ØªÙ†ÙÙ‘Ø³ (4-4-6)</div>
              <p class="mt-1 text-sm text-slate-700">Ø´Ù‡ÙŠÙ‚ 4 Ø«ÙˆØ§Ù†Ù â€” Ø­Ø¨Ø³ 4 â€” Ø²ÙÙŠØ± 6.</p>
            </div>
            <div class="text-xs font-semibold text-slate-500" id="breathState">Ø¬Ø§Ù‡Ø²</div>
          </div>
          <div class="mt-5 grid place-items-center">
            <div class="relative">
              <div id="breathRing" class="grid h-44 w-44 place-items-center rounded-full border-4 border-indigo-200 bg-white text-center transition-all duration-700">
                <div>
                  <div id="breathPhase" class="text-base font-extrabold text-slate-900">Ø§Ø¨Ø¯Ø£</div>
                  <div id="breathCountdown" class="mt-1 text-4xl font-black text-indigo-700">â€”</div>
                  <div class="mt-1 text-xs text-slate-600">Ø¯ÙˆØ±Ø©: <span id="breathCycle">0</span></div>
                </div>
              </div>
            </div>
          </div>
          <div class="mt-5 flex flex-wrap items-center justify-between gap-3">
            <div class="flex items-center gap-2">
              <button id="startBreath" class="rounded-2xl bg-indigo-600 px-4 py-2.5 text-sm font-bold text-white hover:bg-indigo-700">â–¶ï¸ ØªØ´ØºÙŠÙ„</button>
              <button id="stopBreath" class="rounded-2xl border border-slate-200 bg-white px-4 py-2.5 text-sm font-bold text-slate-800 hover:bg-slate-50">â¹ï¸ Ø¥ÙŠÙ‚Ø§Ù</button>
            </div>
            <label class="flex items-center gap-2 text-xs font-semibold text-slate-700">
              Ø§Ù„Ø¯ÙˆØ±Ø§Øª
              <select id="breathCycles" class="rounded-xl border border-slate-200 bg-white px-2 py-2 text-xs font-bold">
                <option value="3">3</option>
                <option value="5">5</option>
                <option value="8">8</option>
              </select>
            </label>
          </div>
        </div>
        <!-- Notes -->
        <div class="rounded-3xl border border-white/40 bg-white/70 p-6 shadow-sm">
          <div class="flex items-start justify-between gap-4">
            <div>
              <div class="text-sm font-extrabold">ğŸ“ Ù…ÙÙƒØ±Ø© Ø¯Ù‚ÙŠÙ‚Ø© ÙˆØ§Ø­Ø¯Ø©</div>
              <p class="mt-1 text-sm text-slate-700">Ø§ÙƒØªØ¨ Ø´ÙŠØ¦Ù‹Ø§ ÙŠØ«Ù‚Ù„ Ø¹Ù„ÙŠÙƒâ€¦ Ø£Ùˆ Ø´ÙŠØ¡Ù‹Ø§ Ù…Ù…ØªÙ† Ù„Ù‡.</p>
            </div>
            <button id="clearNotes" class="rounded-xl border border-slate-200 bg-white px-3 py-2 text-xs font-bold text-slate-800 hover:bg-slate-50">Ø­Ø°Ù Ø§Ù„ÙƒÙ„</button>
          </div>
          <form id="noteForm" class="mt-4 grid gap-3">
            <textarea id="noteText" rows="3" maxlength="500" class="w-full rounded-2xl border border-slate-200 bg-white p-3 text-sm leading-6 outline-none focus:ring-4 focus:ring-indigo-100" placeholder="Ø§ÙƒØªØ¨ Ù‡Ù†Ø§ (Ø­ØªÙ‰ 500 Ø­Ø±Ù)â€¦"></textarea>
            <div class="flex items-center justify-between gap-3">
              <div class="text-xs text-slate-600"><span id="noteCount">0</span>/500</div>
              <button class="rounded-2xl bg-emerald-600 px-4 py-2.5 text-sm font-bold text-white hover:bg-emerald-700" type="submit">ğŸ’¾ Ø­ÙØ¸</button>
            </div>
          </form>
          <div class="mt-4 max-h-40 overflow-auto">
            <ul id="notesList" class="grid gap-2"></ul>
          </div>
        </div>
      </div>
    </section>
    <!-- Resources -->
    <section id="resources" class="pt-14 md:pt-18">
      <div class="rounded-3xl border border-white/40 bg-white/70 p-6 shadow-sm">
        <div class="flex flex-col gap-2 md:flex-row md:items-end md:justify-between">
          <div>
            <h2 class="text-2xl font-extrabold tracking-tight">Ù…ÙˆØ§Ø±Ø¯ ÙˆØ±ÙÙ‚ Ø¨Ø§Ù„Ù†ÙØ³</h2>
            <p class="mt-1 text-sm text-slate-700">Ù‚Ø§Ø¦Ù…Ø© ØµØºÙŠØ±Ø© Ù‚Ø¯ ØªØ³Ø§Ø¹Ø¯Ùƒ Ø¹Ù†Ø¯Ù…Ø§ ØªØ´Ø¹Ø± Ø¨Ø«Ù‚Ù„.</p>
          </div>
          <div class="flex items-center gap-2">
            <input id="resourceSearch" class="w-full md:w-72 rounded-2xl border border-slate-200 bg-white px-3 py-2 text-sm outline-none focus:ring-4 focus:ring-indigo-100" placeholder="ğŸ” Ø§Ø¨Ø­Ø« ÙÙŠ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø©â€¦" />
          </div>
        </div>
        <div class="mt-5 grid gap-3 md:grid-cols-2" id="resourceGrid"></div>
        <div class="mt-6 rounded-2xl border border-rose-200 bg-rose-50 p-4">
          <div class="text-sm font-semibold text-rose-900">ğŸš¨ ØªÙ†Ø¨ÙŠÙ‡ Ù…Ù‡Ù…</div>
          <p class="mt-1 text-sm text-rose-800">
            Ø¥Ø°Ø§ ÙƒÙ†Øª ÙÙŠ Ø®Ø·Ø± ÙÙˆØ±ÙŠ Ø£Ùˆ ØªÙÙƒØ± Ø¨Ø¥ÙŠØ°Ø§Ø¡ Ù†ÙØ³ÙƒØŒ ØªÙˆØ§ØµÙ„ Ù…Ø¹ Ø®Ø¯Ù…Ø§Øª Ø§Ù„Ø·ÙˆØ§Ø±Ø¦ ÙÙŠ Ø¨Ù„Ø¯Ùƒ ÙÙˆØ±Ù‹Ø§ Ø£Ùˆ Ø§Ø·Ù„Ø¨ Ù…Ø³Ø§Ø¹Ø¯Ø© Ø´Ø®Øµ Ù…ÙˆØ«ÙˆÙ‚ Ù‚Ø±ÙŠØ¨ Ù…Ù†Ùƒ.
          </p>
        </div>
      </div>
    </section>
    <!-- Contact -->
    <section id="contact" class="pt-14 pb-16 md:pt-18">
      <div class="grid gap-4 md:grid-cols-2">
        <div class="rounded-3xl border border-white/40 bg-white/70 p-6 shadow-sm">
          <h2 class="text-2xl font-extrabold tracking-tight">ğŸ’Œ ØªÙˆØ§ØµÙ„</h2>
          <p class="mt-2 text-sm leading-7 text-slate-700">
            Ø§ØªØ±Ùƒ Ø±Ø³Ø§Ù„Ø© Ø¯Ø¹Ù… Ø£Ùˆ Ø§Ù‚ØªØ±Ø§Ø­. ÙŠØªÙ… Ø­ÙØ¸Ù‡Ø§ Ù…Ø­Ù„ÙŠÙ‹Ø§ Ø¹Ù„Ù‰ Ø¬Ù‡Ø§Ø²Ùƒ.
          </p>
          <div class="mt-4 rounded-2xl border border-slate-200 bg-white p-4">
            <div class="text-xs font-semibold text-slate-500">ÙÙƒØ±Ø© Ù„Ù„Ù…ÙˆÙ‚Ø¹</div>
            <div class="mt-1 font-bold text-slate-900">"Ù„Ø³Øª ÙˆØ­Ø¯Ùƒâ€¦ Ø®Ø·ÙˆØ© ØµØºÙŠØ±Ø© Ø§Ù„ÙŠÙˆÙ… ØªÙƒÙÙŠ." ğŸ’š</div>
          </div>
        </div>
        <div class="rounded-3xl border border-white/40 bg-white/70 p-6 shadow-sm">
          <form id="contactForm" class="grid gap-3">
            <div>
              <label class="mb-1 block text-xs font-semibold text-slate-600">Ø§Ù„Ø§Ø³Ù…</label>
              <input id="cName" class="w-full rounded-2xl border border-slate-200 bg-white px-3 py-2.5 text-sm outline-none focus:ring-4 focus:ring-indigo-100" placeholder="Ø§Ø³Ù…Ùƒ" />
            </div>
            <div>
              <label class="mb-1 block text-xs font-semibold text-slate-600">Ø§Ù„Ø±Ø³Ø§Ù„Ø©</label>
              <textarea id="cMsg" rows="3" class="w-full rounded-2xl border border-slate-200 bg-white p-3 text-sm leading-6 outline-none focus:ring-4 focus:ring-indigo-100" placeholder="Ø§ÙƒØªØ¨ Ø±Ø³Ø§Ù„ØªÙƒâ€¦"></textarea>
            </div>
            <button type="submit" class="rounded-2xl bg-indigo-600 px-4 py-2.5 text-sm font-bold text-white hover:bg-indigo-700">ğŸ’¾ Ø­ÙØ¸ Ø§Ù„Ø±Ø³Ø§Ù„Ø©</button>
            <div id="contactAlert" class="hidden rounded-2xl border px-3 py-2 text-sm font-semibold"></div>
          </form>
        </div>
      </div>
    </section>
  </main>
  <footer class="border-t border-white/20 bg-white/30 relative z-10">
    <div class="mx-auto max-w-6xl px-4 py-8">
      <div class="flex flex-col gap-2 md:flex-row md:items-center md:justify-between">
        <div class="text-sm font-extrabold">Ù…Ù„Ø§Ø°Ùƒ Ø§Ù„Ø¢Ù…Ù† | Safe Haven ğŸ’š</div>
        <div class="text-xs text-slate-600">Â© <span id="year"></span> â€” Ù…Ø³Ø§Ø­Ø© Ø¢Ù…Ù†Ø© Ù„Ù„Ø¬Ù…ÙŠØ¹</div>
      </div>
    </div>
  </footer>
  <script>
    // --- Helpers ---
    const $ = (s, el = document) => el.querySelector(s);
    const $$ = (s, el = document) => Array.from(el.querySelectorAll(s));
    const sleep = (ms) => new Promise(r => setTimeout(r, ms));
    function escapeHtml(str) {
      return String(str).replace(/&/g, '&amp;').replace(/</g, '&lt;').replace(/>/g, '&gt;').replace(/"/g, '&quot;');
    }
    // --- Rain Animation ---
    function createRainDrops() {
      const container = $('#rainContainer');
      const dropCount = 80;
      
      for (let i = 0; i < dropCount; i++) {
        const drop = document.createElement('div');
        drop.className = 'rain-drop';
        drop.style.left = Math.random() * 100 + '%';
        drop.style.height = (Math.random() * 20 + 10) + 'px';
        drop.style.animationDuration = (Math.random() * 1 + 0.5) + 's';
        drop.style.animationDelay = (Math.random() * 2) + 's';
        drop.style.opacity = Math.random() * 0.5 + 0.3;
        container.appendChild(drop);
      }
    }
    createRainDrops();
    // --- Background Rain Audio (Auto-play) ---
    let audioCtx = null;
    let rainGain = null;
    let isMuted = false;
    function createRainAudio() {
      if (audioCtx) return;
      
      try {
        audioCtx = new (window.AudioContext || window.webkitAudioContext)();
        
        // Create brown noise for rain
        const bufferSize = 2 * audioCtx.sampleRate;
        const noiseBuffer = audioCtx.createBuffer(1, bufferSize, audioCtx.sampleRate);
        const output = noiseBuffer.getChannelData(0);
        
        let lastOut = 0;
        for (let i = 0; i < bufferSize; i++) {
          const white = Math.random() * 2 - 1;
          output[i] = (lastOut + (0.02 * white)) / 1.02;
          lastOut = output[i];
          output[i] *= 3.5;
        }
        const noiseSource = audioCtx.createBufferSource();
        noiseSource.buffer = noiseBuffer;
        noiseSource.loop = true;
        // Filters for rain-like sound
        const highpass = audioCtx.createBiquadFilter();
        highpass.type = 'highpass';
        highpass.frequency.value = 200;
        const lowpass = audioCtx.createBiquadFilter();
        lowpass.type = 'lowpass';
        lowpass.frequency.value = 3000;
        rainGain = audioCtx.createGain();
        rainGain.gain.value = 0.15;
        noiseSource.connect(highpass);
        highpass.connect(lowpass);
        lowpass.connect(rainGain);
        rainGain.connect(audioCtx.destination);
        noiseSource.start();
      } catch (e) {
        console.log('Audio not supported');
      }
    }
    // Start audio on first interaction
    function startAudioOnInteraction() {
      if (!audioCtx) {
        createRainAudio();
      }
      if (audioCtx && audioCtx.state === 'suspended') {
        audioCtx.resume();
      }
    }
    document.addEventListener('click', startAudioOnInteraction, { once: true });
    document.addEventListener('touchstart', startAudioOnInteraction, { once: true });
    // Mute toggle
    $('#muteToggle').addEventListener('click', () => {
      isMuted = !isMuted;
      $('#muteLabel').textContent = isMuted ? 'ğŸ”‡' : 'ğŸ”Š';
      if (rainGain) {
        rainGain.gain.value = isMuted ? 0 : 0.15;
      }
    });
    // --- Mobile menu ---
    $('#openMenu').addEventListener('click', () => {
      $('#mobileMenu').classList.toggle('hidden');
    });
    $$('#mobileMenu a').forEach(a => a.addEventListener('click', () => $('#mobileMenu').classList.add('hidden')));
    // --- Mood board ---
    const moodKey = 'safeHaven.mood';
    const suggestionEl = $('#moodSuggestion');
    const statMoodEl = $('#statMood');
    const suggestions = {
      'Ù…ØªÙˆØªØ±': 'ğŸ§˜ Ø¬Ø±Ù‘Ø¨ ØªÙ…Ø±ÙŠÙ† Ø§Ù„ØªÙ†ÙÙ‘Ø³ Ù„Ø¯Ù‚ÙŠÙ‚ØªÙŠÙ†ØŒ Ø«Ù… Ø§ÙƒØªØ¨ Ø¬Ù…Ù„Ø© ÙˆØ§Ø­Ø¯Ø© Ø¹Ù…Ù‘Ø§ ÙŠÙ‚Ù„Ù‚Ùƒ.',
      'Ø­Ø²ÙŠÙ†': 'ğŸ’š Ø§Ø®ØªØ± Ø´Ø®ØµÙ‹Ø§ Ø¢Ù…Ù†Ù‹Ø§ ÙˆØªÙˆØ§ØµÙ„ Ù…Ø¹Ù‡ Ø¨Ø±Ø³Ø§Ù„Ø© Ù‚ØµÙŠØ±Ø©. Ø«Ù… Ø§Ø´Ø±Ø¨ Ù…Ø§Ø¡Ù‹ ÙˆØ§Ù…Ø´Ù 5 Ø¯Ù‚Ø§Ø¦Ù‚.',
      'Ù…Ø´ØªÙ‘Øª': 'ğŸ“ Ø§ÙƒØªØ¨ 3 Ù…Ù‡Ø§Ù… ØµØºÙŠØ±Ø© ÙÙ‚Ø·. Ø§Ø®ØªØ± ÙˆØ§Ø­Ø¯Ø© ÙˆØ§Ø¨Ø¯Ø£ Ù„Ù…Ø¯Ø© 10 Ø¯Ù‚Ø§Ø¦Ù‚.',
      'Ù…Ù…ØªÙ†': 'ğŸ™ Ø¯ÙˆÙ‘Ù† Ø³Ø¨Ø¨ Ø§Ù…ØªÙ†Ø§Ù† ÙˆØ§Ø­Ø¯ Ø§Ù„ÙŠÙˆÙ…ØŒ ÙˆØ´Ø§Ø±ÙƒÙ‡ Ù…Ø¹ Ø´Ø®Øµ ØªØ­Ø¨Ù‡ Ø¥Ù† Ø±ØºØ¨Øª.'
    };
    function setMood(mood) {
      if (!mood) {
        suggestionEl.textContent = 'Ø§Ø®ØªØ± Ù…Ø²Ø§Ø¬Ùƒ Ù„Ø¹Ø±Ø¶ Ø§Ù‚ØªØ±Ø§Ø­ Ù…Ù†Ø§Ø³Ø¨.';
        statMoodEl.textContent = 'â€”';
        localStorage.removeItem(moodKey);
        $$('.moodBtn').forEach(b => b.classList.remove('ring-2', 'ring-indigo-500'));
        return;
      }
      localStorage.setItem(moodKey, mood);
      suggestionEl.textContent = suggestions[mood] || 'Ø®Ø° Ù†ÙØ³Ù‹Ø§ Ø¹Ù…ÙŠÙ‚Ù‹Ø§â€¦ Ø³ØªÙƒÙˆÙ† Ø¨Ø®ÙŠØ±. ğŸ’š';
      statMoodEl.textContent = mood;
      $$('.moodBtn').forEach(b => {
        b.classList.toggle('ring-2', b.dataset.mood === mood);
        b.classList.toggle('ring-indigo-500', b.dataset.mood === mood);
      });
    }
    $$('.moodBtn').forEach(btn => btn.addEventListener('click', () => setMood(btn.dataset.mood)));
    $('#clearMood').addEventListener('click', () => setMood(null));
    setMood(localStorage.getItem(moodKey));
    // --- Breathing timer (4-4-6) ---
    const breath = {
      running: false,
      timer: null,
      phaseIndex: 0,
      remaining: 0,
      cycle: 0,
      targetCycles: 3,
      phases: [
        { name: 'Ø´Ù‡ÙŠÙ‚ ğŸŒ¬ï¸', seconds: 4, scale: 1.15, color: 'border-indigo-400' },
        { name: 'Ø­Ø¨Ø³ â¸ï¸', seconds: 4, scale: 1.2, color: 'border-amber-400' },
        { name: 'Ø²ÙÙŠØ± ğŸ’¨', seconds: 6, scale: 0.9, color: 'border-emerald-400' }
      ]
    };
    const breathRing = $('#breathRing');
    const breathPhaseEl = $('#breathPhase');
    const breathCountdownEl = $('#breathCountdown');
    const breathCycleEl = $('#breathCycle');
    const breathStateEl = $('#breathState');
    function renderBreath() {
      const phase = breath.phases[breath.phaseIndex];
      breathPhaseEl.textContent = phase.name;
      breathCountdownEl.textContent = breath.remaining;
      breathCycleEl.textContent = breath.cycle;
      breathStateEl.textContent = breath.running ? 'ğŸ”„ ÙŠØ¹Ù…Ù„' : 'â¹ï¸ Ø¬Ø§Ù‡Ø²';
      breathRing.style.transform = `scale(${phase.scale})`;
      breathRing.className = `grid h-44 w-44 place-items-center rounded-full border-4 ${phase.color} bg-white text-center transition-all duration-700`;
    }
    function stopBreath() {
      breath.running = false;
      clearInterval(breath.timer);
      breath.phaseIndex = 0;
      breath.remaining = 0;
      breath.cycle = 0;
      breathPhaseEl.textContent = 'Ø§Ø¨Ø¯Ø£';
      breathCountdownEl.textContent = 'â€”';
      breathCycleEl.textContent = '0';
      breathStateEl.textContent = 'â¹ï¸ Ø¬Ø§Ù‡Ø²';
      breathRing.style.transform = 'scale(1)';
      breathRing.className = 'grid h-44 w-44 place-items-center rounded-full border-4 border-indigo-200 bg-white text-center transition-all duration-700';
    }
    function nextPhase() {
      breath.phaseIndex = (breath.phaseIndex + 1) % breath.phases.length;
      if (breath.phaseIndex === 0) {
        breath.cycle += 1;
        if (breath.cycle > breath.targetCycles) {
          stopBreath();
          breathStateEl.textContent = 'âœ… ØªÙ…';
          breathPhaseEl.textContent = 'ğŸ‰ Ø£Ø­Ø³Ù†Øª!';
          breathCountdownEl.textContent = 'âœ“';
          return;
        }
      }
      breath.remaining = breath.phases[breath.phaseIndex].seconds;
      renderBreath();
    }
    function tick() {
      if (!breath.running) return;
      if (breath.remaining <= 1) {
        nextPhase();
        return;
      }
      breath.remaining -= 1;
      renderBreath();
    }
    $('#breathCycles').addEventListener('change', (e) => {
      breath.targetCycles = parseInt(e.target.value, 10);
    });
    $('#startBreath').addEventListener('click', () => {
      if (breath.running) return;
      breath.running = true;
      breath.targetCycles = parseInt($('#breathCycles').value, 10);
      breath.cycle = 1;
      breath.phaseIndex = 0;
      breath.remaining = breath.phases[0].seconds;
      renderBreath();
      breath.timer = setInterval(tick, 1000);
    });
    $('#stopBreath').addEventListener('click', stopBreath);
    // --- Notes ---
    const notesKey = 'safeHaven.notes';
    const noteText = $('#noteText');
    const notesList = $('#notesList');
    function loadNotes() {
      try { return JSON.parse(localStorage.getItem(notesKey) || '[]'); }
      catch { return []; }
    }
    function saveNotes(notes) {
      localStorage.setItem(notesKey, JSON.stringify(notes));
      $('#statNotes').textContent = String(notes.length);
    }
    function renderNotes() {
      const notes = loadNotes();
      notesList.innerHTML = '';
      if (!notes.length) {
        notesList.innerHTML = '<li class="text-sm text-slate-500 text-center py-4">Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø¨Ø¹Ø¯ ğŸ“</li>';
        saveNotes(notes);
        return;
      }
      notes.forEach((n, idx) => {
        const li = document.createElement('li');
        li.className = 'rounded-2xl border border-slate-200 bg-white p-3';
        li.innerHTML = `
          <div class="flex items-start justify-between gap-2">
            <div class="text-sm text-slate-900 whitespace-pre-wrap break-words">${escapeHtml(n.text)}</div>
            <button class="removeNote text-xs text-slate-400 hover:text-rose-500" data-idx="${idx}">âœ•</button>
          </div>
          <div class="mt-1 text-xs text-slate-400">${new Date(n.ts).toLocaleString('ar')}</div>
        `;
        notesList.appendChild(li);
      });
      $$('.removeNote', notesList).forEach(btn => btn.addEventListener('click', (e) => {
        const i = parseInt(e.currentTarget.dataset.idx, 10);
        const notes = loadNotes();
        notes.splice(i, 1);
        saveNotes(notes);
        renderNotes();
      }));
      saveNotes(notes);
    }
    noteText.addEventListener('input', () => {
      $('#noteCount').textContent = String(noteText.value.length);
    });
    $('#noteForm').addEventListener('submit', (e) => {
      e.preventDefault();
      const text = noteText.value.trim();
      if (text.length < 3) return;
      const notes = loadNotes();
      notes.unshift({ text, ts: Date.now() });
      localStorage.setItem(notesKey, JSON.stringify(notes.slice(0, 20)));
      noteText.value = '';
      $('#noteCount').textContent = '0';
      renderNotes();
    });
    $('#clearNotes').addEventListener('click', () => {
      localStorage.removeItem(notesKey);
      renderNotes();
    });
    // --- Resources ---
    const resources = [
      { title: 'ğŸ¯ Ù‚Ø§Ø¹Ø¯Ø© 5-4-3-2-1', text: 'Ù„Ø§Ø­Ø¸ 5 Ø£Ø´ÙŠØ§Ø¡ ØªØ±Ø§Ù‡Ø§ØŒ 4 ØªÙ„Ù…Ø³Ù‡Ø§ØŒ 3 ØªØ³Ù…Ø¹Ù‡Ø§ØŒ 2 ØªØ´Ù…Ù‘Ù‡Ø§ØŒ 1 ØªØªØ°ÙˆÙ‚Ù‡.' },
      { title: 'ğŸ“´ ØªÙ‚Ù„ÙŠÙ„ Ø§Ù„Ù…ÙØ­ÙÙ‘Ø²Ø§Øª', text: 'Ø®ÙÙ‘Ø¶ Ø§Ù„ØµÙˆØª ÙˆØ§Ù„Ø¥Ø¶Ø§Ø¡Ø©ØŒ ÙˆØ¶Ø¹ Ø§Ù„Ù‡Ø§ØªÙ Ø¨Ø¹ÙŠØ¯Ù‹Ø§ 10 Ø¯Ù‚Ø§Ø¦Ù‚.' },
      { title: 'ğŸ’Œ Ø±Ø³Ø§Ù„Ø© Ù„Ø·ÙŠÙØ© Ù„Ù†ÙØ³Ùƒ', text: 'Ø§ÙƒØªØ¨: "Ø£Ù†Ø§ Ø£Ù…Ø±Ù‘ Ø¨Ù„Ø­Ø¸Ø© ØµØ¹Ø¨Ø©ØŒ ÙˆÙ‡Ø°Ø§ Ø·Ø¨ÙŠØ¹ÙŠâ€¦ Ø³Ø£Ø¹ØªÙ†ÙŠ Ø¨Ù†ÙØ³ÙŠ."' },
      { title: 'ğŸš¶ Ø­Ø±ÙƒØ© Ø¨Ø³ÙŠØ·Ø©', text: 'ØªÙ…Ø¯Ø¯ Ø£Ùˆ Ø§Ù…Ø´Ù Ø¯Ø§Ø®Ù„ Ø§Ù„ØºØ±ÙØ© 2â€“5 Ø¯Ù‚Ø§Ø¦Ù‚. Ø§Ù„Ø­Ø±ÙƒØ© ØªØºÙŠÙ‘Ø± Ø§Ù„Ø¥Ø­Ø³Ø§Ø³.' },
      { title: 'â“ Ø³Ø¤Ø§Ù„ ØµØºÙŠØ±', text: 'Ù…Ø§ Ø§Ù„Ø´ÙŠØ¡ Ø§Ù„ÙˆØ§Ø­Ø¯ Ø§Ù„Ø°ÙŠ Ø¥Ù† ÙØ¹Ù„ØªÙ‡ Ø§Ù„Ø¢Ù† Ø³ÙŠØ¬Ø¹Ù„ Ø§Ù„ÙŠÙˆÙ… Ø£Ø³Ù‡Ù„ 1%ØŸ' },
      { title: 'ğŸ’§ Ù…Ø§Ø¡ + Ù†ÙØ³', text: 'Ø§Ø´Ø±Ø¨ ÙƒÙˆØ¨ Ù…Ø§Ø¡ØŒ Ø«Ù… Ø®Ø° 3 Ø£Ù†ÙØ§Ø³ Ø¨Ø·ÙŠØ¦Ø©. ØªØ±ØªÙŠØ¨ Ø¨Ø³ÙŠØ· Ù„ÙƒÙ†Ù‡ ÙØ¹Ù‘Ø§Ù„.' }
    ];
    function renderResources(filter = '') {
      const q = filter.trim().toLowerCase();
      const grid = $('#resourceGrid');
      const items = resources.filter(r => (r.title + ' ' + r.text).toLowerCase().includes(q));
      grid.innerHTML = items.map(r => `
        <div class="rounded-2xl border border-slate-200 bg-white p-4">
          <div class="text-sm font-extrabold text-slate-900">${r.title}</div>
          <p class="mt-2 text-sm text-slate-700">${r.text}</p>
        </div>
      `).join('') || '<div class="text-sm text-slate-500 text-center py-4">Ù„Ø§ ØªÙˆØ¬Ø¯ Ù†ØªØ§Ø¦Ø¬ ğŸ”</div>';
    }
    $('#resourceSearch').addEventListener('input', (e) => renderResources(e.target.value));
    // --- Contact ---
    const contactKey = 'safeHaven.contact';
    const alertEl = $('#contactAlert');
    $('#contactForm').addEventListener('submit', (e) => {
      e.preventDefault();
      const name = $('#cName').value.trim();
      const msg = $('#cMsg').value.trim();
      if (name.length < 2 || msg.length < 5) {
        alertEl.className = 'rounded-2xl border border-rose-200 bg-rose-50 px-3 py-2 text-sm font-semibold text-rose-900';
        alertEl.textContent = 'âš ï¸ Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ø³Ù… ÙˆØ±Ø³Ø§Ù„Ø© ØµØ­ÙŠØ­Ø©.';
        alertEl.classList.remove('hidden');
        return;
      }
      localStorage.setItem(contactKey, JSON.stringify({ name, msg, ts: Date.now() }));
      alertEl.className = 'rounded-2xl border border-emerald-200 bg-emerald-50 px-3 py-2 text-sm font-semibold text-emerald-900';
      alertEl.textContent = 'âœ… ØªÙ… Ø­ÙØ¸ Ø§Ù„Ø±Ø³Ø§Ù„Ø© Ø¨Ù†Ø¬Ø§Ø­!';
      alertEl.classList.remove('hidden');
      $('#cName').value = '';
      $('#cMsg').value = '';
    });
    // --- OpenAI Chat ---
    const apiKeyKey = 'safeHaven.apiKey';
    const chatKey = 'safeHaven.chat';
    const chatLog = $('#chatLog');
    const chatForm = $('#chatForm');
    const chatInput = $('#chatInput');
    const chatLang = $('#chatLang');
    const apiKeyInput = $('#apiKeyInput');
    const apiStatus = $('#apiStatus');
    let lastReply = '';
    // Load saved API key
    const savedApiKey = localStorage.getItem(apiKeyKey);
    if (savedApiKey) {
      apiKeyInput.value = savedApiKey;
      apiStatus.innerHTML = 'âœ… <span class="text-emerald-700">Ø§Ù„Ù…ÙØªØ§Ø­ Ù…Ø­ÙÙˆØ¸ ÙˆÙ…ÙØ¹Ù‘Ù„</span>';
    } else {
      apiStatus.innerHTML = 'âš ï¸ <span class="text-amber-700">Ù„Ù… ÙŠØªÙ… Ø¥Ø¯Ø®Ø§Ù„ Ù…ÙØªØ§Ø­ API Ø¨Ø¹Ø¯</span>';
    }
    $('#saveApiKey').addEventListener('click', () => {
      const key = apiKeyInput.value.trim();
      if (key && key.startsWith('sk-')) {
        localStorage.setItem(apiKeyKey, key);
        apiStatus.innerHTML = 'âœ… <span class="text-emerald-700">ØªÙ… Ø­ÙØ¸ Ø§Ù„Ù…ÙØªØ§Ø­ Ø¨Ù†Ø¬Ø§Ø­!</span>';
      } else {
        apiStatus.innerHTML = 'âŒ <span class="text-rose-700">Ù…ÙØªØ§Ø­ ØºÙŠØ± ØµØ­ÙŠØ­ (ÙŠØ¬Ø¨ Ø£Ù† ÙŠØ¨Ø¯Ø£ Ø¨Ù€ sk-)</span>';
      }
    });
    $('#clearApiKey').addEventListener('click', () => {
      localStorage.removeItem(apiKeyKey);
      apiKeyInput.value = '';
      apiStatus.innerHTML = 'ğŸ—‘ï¸ <span class="text-slate-600">ØªÙ… Ù…Ø³Ø­ Ø§Ù„Ù…ÙØªØ§Ø­</span>';
    });
    function loadChat() {
      try { return JSON.parse(localStorage.getItem(chatKey) || '[]'); }
      catch { return []; }
    }
    function saveChat(items) {
      localStorage.setItem(chatKey, JSON.stringify(items.slice(-30)));
    }
    function createBubble(role, text, lang) {
      const isUser = role === 'user';
      const div = document.createElement('div');
      div.className = `mb-3 flex ${isUser ? 'justify-start' : 'justify-end'}`;
      
      const bubble = document.createElement('div');
      bubble.className = `max-w-[85%] rounded-2xl p-3 ${isUser ? 'bg-slate-100 text-slate-900' : 'bg-indigo-600 text-white'}`;
      bubble.innerHTML = `
        <div class="text-xs font-semibold mb-1 ${isUser ? 'text-slate-500' : 'text-indigo-200'}">${isUser ? (lang === 'ar' ? 'Ø£Ù†Ø§' : 'Me') : (lang === 'ar' ? 'ğŸ¤– Ø§Ù„Ù…Ù„Ø§Ø°' : 'ğŸ¤– Safe Haven')}</div>
        <div class="text-sm leading-relaxed whitespace-pre-wrap">${escapeHtml(text)}</div>
      `;
      div.appendChild(bubble);
      return div;
    }
    function createTypingIndicator() {
      const div = document.createElement('div');
      div.className = 'mb-3 flex justify-end';
      div.id = 'typingIndicator';
      div.innerHTML = `
        <div class="max-w-[85%] rounded-2xl bg-indigo-600 p-3">
          <div class="typing-dots">
            <span></span><span></span><span></span>
          </div>
        </div>
      `;
      return div;
    }
    function renderChat() {
      const items = loadChat();
      chatLog.innerHTML = '';
      
      if (!items.length) {
        chatLog.innerHTML = `
          <div class="text-sm text-slate-500 text-center py-8">
            <div class="text-4xl mb-3">ğŸ’¬</div>
            Ø§Ø¨Ø¯Ø£ Ø¨ÙƒØªØ§Ø¨Ø© Ø±Ø³Ø§Ù„Ø© Ù„Ù„ØªØ­Ø¯Ø« Ù…Ø¹ Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠâ€¦<br>
            Start typing to chat with AIâ€¦
          </div>
        `;
        return;
      }
      
      items.forEach(m => chatLog.appendChild(createBubble(m.role, m.text, m.lang)));
      chatLog.scrollTop = chatLog.scrollHeight;
    }
    $('#clearChat').addEventListener('click', () => {
      localStorage.removeItem(chatKey);
      renderChat();
    });
    $$('.quickPrompt').forEach(b => b.addEventListener('click', () => {
      chatInput.value = b.dataset.q;
      chatInput.focus();
    }));
    // System prompt for empathetic, gender-neutral responses
    const systemPromptAr = `Ø£Ù†Øª Ù…Ø³Ø§Ø¹Ø¯ Ø¯Ø§Ø¹Ù… Ù†ÙØ³ÙŠ Ù„Ø·ÙŠÙ ÙˆÙ…ØªØ¹Ø§Ø·Ù. Ù‚ÙˆØ§Ø¹Ø¯ Ù…Ù‡Ù…Ø© Ø¬Ø¯Ø§Ù‹:
1. Ø§Ø³ØªØ®Ø¯Ù… Ù„ØºØ© Ù…Ø­Ø§ÙŠØ¯Ø© Ø¬Ù†Ø¯Ø±ÙŠØ§Ù‹ - Ù„Ø§ ØªØ³ØªØ®Ø¯Ù… "Ø£Ù†Øª" Ø£Ùˆ "Ø£Ù†ØªÙ" Ù…Ø·Ù„Ù‚Ø§Ù‹. Ø¨Ø¯Ù„Ø§Ù‹ Ù…Ù† Ø°Ù„Ùƒ Ø§Ø³ØªØ®Ø¯Ù… ØµÙŠØº Ù…Ø«Ù„ "ÙŠØ¨Ø¯Ùˆ Ø£Ù† Ù‡Ù†Ø§Ùƒ..." Ø£Ùˆ "Ù…Ù† Ø§Ù„Ø·Ø¨ÙŠØ¹ÙŠ Ø£Ù† ÙŠØ´Ø¹Ø± Ø§Ù„Ø¥Ù†Ø³Ø§Ù†..."
2. ÙƒÙ† Ø¯Ø§ÙØ¦Ø§Ù‹ ÙˆÙ…ØªØ¹Ø§Ø·ÙØ§Ù‹ ÙˆØ¯Ø§Ø¹Ù…Ø§Ù‹
3. Ù‚Ø¯Ù… Ù†ØµØ§Ø¦Ø­ Ø¹Ù…Ù„ÙŠØ© Ø¨Ø³ÙŠØ·Ø© ÙˆØ®Ø·ÙˆØ§Øª ØµØºÙŠØ±Ø©
4. Ù„Ø§ ØªÙ‚Ø¯Ù… ØªØ´Ø®ÙŠØµØ§Øª Ø·Ø¨ÙŠØ©
5. ÙÙŠ Ø­Ø§Ù„Ø§Øª Ø§Ù„Ø®Ø·Ø±ØŒ ÙˆØ¬Ù‘Ù‡ Ù„Ù„Ø·ÙˆØ§Ø±Ø¦ Ø£Ùˆ Ù…Ø®ØªØµ
6. Ø§Ø³ØªØ®Ø¯Ù… Ø¥ÙŠÙ…ÙˆØ¬ÙŠ Ø¨Ø´ÙƒÙ„ Ù…Ø¹ØªØ¯Ù„ ğŸ’š
7. Ø§Ø¬Ø¹Ù„ Ø±Ø¯ÙˆØ¯Ùƒ Ù‚ØµÙŠØ±Ø© ÙˆÙ…Ø±ÙƒØ²Ø© (3-5 Ø¬Ù…Ù„)`;
    const systemPromptEn = `You are a kind, empathetic mental health support assistant. Important rules:
1. Use gender-neutral language - avoid "you" when possible, use phrases like "It sounds like..." or "It's natural to feel..."
2. Be warm, empathetic, and supportive
3. Offer simple, practical advice and small steps
4. Don't provide medical diagnoses
5. In dangerous situations, direct to emergency services or a professional
6. Use emojis moderately ğŸ’š
7. Keep responses short and focused (3-5 sentences)`;
    async function sendToOpenAI(userMessage, lang) {
      const apiKey = localStorage.getItem(apiKeyKey);
      
      if (!apiKey) {
        return lang === 'ar' 
          ? 'âš ï¸ Ù„Ù… ÙŠØªÙ… Ø¥Ø¯Ø®Ø§Ù„ Ù…ÙØªØ§Ø­ API. ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ù…ÙØªØ§Ø­ OpenAI ÙÙŠ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø£Ø¹Ù„Ø§Ù‡ Ù„ØªÙØ¹ÙŠÙ„ Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø© Ø§Ù„Ø°ÙƒÙŠØ©.'
          : 'âš ï¸ No API key entered. Please enter your OpenAI API key in the settings above to enable AI chat.';
      }
      const systemPrompt = lang === 'ar' ? systemPromptAr : systemPromptEn;
      
      try {
        const response = await fetch('https://api.openai.com/v1/chat/completions', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
            'Authorization': `Bearer ${apiKey}`
          },
          body: JSON.stringify({
            model: 'gpt-3.5-turbo',
            messages: [
              { role: 'system', content: systemPrompt },
              { role: 'user', content: userMessage }
            ],
            max_tokens: 300,
            temperature: 0.7
          })
        });
        if (!response.ok) {
          const error = await response.json();
          if (response.status === 401) {
            return lang === 'ar' 
              ? 'âŒ Ù…ÙØªØ§Ø­ API ØºÙŠØ± ØµØ­ÙŠØ­. ÙŠØ±Ø¬Ù‰ Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ù…ÙØªØ§Ø­ ÙÙŠ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª.'
              : 'âŒ Invalid API key. Please check your key in the settings.';
          }
          throw new Error(error.error?.message || 'API Error');
        }
        const data = await response.json();
        return data.choices[0].message.content;
      } catch (error) {
        console.error('OpenAI Error:', error);
        return lang === 'ar'
          ? 'âš ï¸ Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„. ÙŠØ±Ø¬Ù‰ Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø© Ù…Ø±Ø© Ø£Ø®Ø±Ù‰.'
          : 'âš ï¸ Connection error. Please try again.';
      }
    }
    chatForm.addEventListener('submit', async (e) => {
      e.preventDefault();
      const text = chatInput.value.trim();
      const lang = chatLang.value;
      
      if (text.length < 2) return;
      const items = loadChat();
      items.push({ role: 'user', text, ts: Date.now(), lang });
      saveChat(items);
      chatInput.value = '';
      renderChat();
      // Show typing indicator
      chatLog.appendChild(createTypingIndicator());
      chatLog.scrollTop = chatLog.scrollHeight;
      // Get AI response
      const reply = await sendToOpenAI(text, lang);
      
      // Remove typing indicator
      const typingEl = $('#typingIndicator');
      if (typingEl) typingEl.remove();
      // Add AI response
      items.push({ role: 'assistant', text: reply, ts: Date.now(), lang });
      saveChat(items);
      renderChat();
      
      lastReply = reply;
    });
    // TTS
    function speak(text, lang) {
      if (!('speechSynthesis' in window)) return;
      window.speechSynthesis.cancel();
      const u = new SpeechSynthesisUtterance(text);
      u.lang = lang === 'en' ? 'en-US' : 'ar-SA';
      u.rate = 0.9;
      window.speechSynthesis.speak(u);
    }
    $('#speakLast').addEventListener('click', () => {
      if (lastReply) {
        speak(lastReply, chatLang.value);
      }
    });
    $('#stopSpeak').addEventListener('click', () => {
      if ('speechSynthesis' in window) {
        window.speechSynthesis.cancel();
      }
    });
    // --- Init ---
    $('#year').textContent = String(new Date().getFullYear());
    renderNotes();
    renderResources('');
    renderChat();
    function updateBreathStat() { 
      $('#statBreaths').textContent = $('#breathCycles').value; 
    }
    $('#breathCycles').addEventListener('change', updateBreathStat);
    updateBreathStat();
  </script>
</body>
</html>
